using UnityEngine;

class Invulnerability : Buff
{
    ActionListener nodmg;
    SpriteRenderer sr;
    public Invulnerability(Unit unit, float duration)
        : base(unit, duration)
    {
        nodmg = new NoDamage();
        unit.eventManager.SubscribeInterceptor("takeDmg", nodmg);
        sr = unit.sr;
        unit.GetComponent<SpritePainter>().Paint(new Color(sr.color.r, sr.color.g, sr.color.b, 0.5f), duration, false);
        imagePath = "Buffs/invulnerability";
        if (unit is Player)
        {
            Player.IgnoreEnemyCollisions(true);
        }
    }

    public override void End()
    {
        base.End();
        unit.eventManager.UnsubscribeInterceptor("takeDmg", nodmg);
        if (unit is Player)
        {
            Player.IgnoreEnemyCollisions(false);
        }
    }

    class NoDamage : ActionListener
    {
        public bool Handle(ActionParams ap)
        {
            ap.forbid = true;
            return false;
        }
    }
}